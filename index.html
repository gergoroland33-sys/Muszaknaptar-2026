<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forvia SMT | Műszaknaptár Pro</title>
<style>
:root {
--primary: #3b82f6;
--bg: #0f172a;
--card-bg: #1e293b;
--card-border: #334155;
--text-main: #f1f5f9;
--text-muted: #94a3b8;
--accent: #fbbf24;
--color-A: #60a5fa;
--color-B: #4ade80;
--color-C: #fbbf24;
--color-D: #f87171;
}

body {
font-family: 'Inter', -apple-system, sans-serif;
background-color: var(--bg);
background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
margin: 0;
padding: 15px;
color: var(--text-main);
min-height: 100vh;
}

.container { max-width: 550px; margin: 0 auto; }

header { text-align: center; margin-bottom: 20px; padding-top: 10px; }
header h1 {
font-size: 1.6rem;
font-weight: 800;
margin: 0;
background: linear-gradient(to right, #60a5fa, #3b82f6);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
}

.filter-panel {
background: var(--card-bg);
padding: 20px;
border-radius: 20px;
border: 1px solid var(--card-border);
margin-bottom: 25px;
display: grid;
grid-template-columns: 1fr 1fr;
gap: 12px;
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
}

label {
display: block;
font-size: 0.7rem;
text-transform: uppercase;
letter-spacing: 0.05em;
color: var(--text-muted);
margin-bottom: 6px;
}

select {
width: 100%;
padding: 12px;
background: #0f172a;
border: 1px solid var(--card-border);
border-radius: 12px;
color: white;
font-size: 15px;
outline: none;
}

.gomb {
grid-column: span 2;
padding: 14px;
background: rgba(59, 130, 246, 0.1);
color: var(--primary);
border: 1px solid var(--primary);
border-radius: 12px;
font-weight: 700;
cursor: pointer;
transition: 0.2s;
}

.gomb:hover { background: var(--primary); color: white; }

.date-header {
font-size: 1rem;
font-weight: 800;
color: #ffffff;
margin: 25px 0 12px 0;
display: flex;
align-items: center;
justify-content: space-between;
background: rgba(255, 255, 255, 0.03);
padding: 10px 15px;
border-radius: 12px;
border-left: 4px solid var(--primary);
}

.date-header.weekend {
border-left-color: var(--accent);
background: rgba(251, 191, 36, 0.05);
}

.day-name {
font-size: 0.8rem;
font-weight: 500;
color: var(--primary);
text-transform: uppercase;
}

.weekend .day-name { color: var(--accent); }

.shift-card {
background: var(--card-bg);
border: 1px solid var(--card-border);
padding: 16px;
border-radius: 18px;
margin-bottom: 10px;
display: flex;
align-items: center;
justify-content: space-between;
position: relative;
}

.shift-info { display: flex; flex-direction: column; gap: 4px; }
.shift-location { font-weight: 700; font-size: 1.05rem; }
.shift-leader { font-size: 0.8rem; color: var(--text-muted); }
.leader-name { color: var(--text-main); font-weight: 500; }

.shift-badge {
width: 48px;
height: 48px;
border-radius: 14px;
display: flex;
align-items: center;
justify-content: center;
font-weight: 800;
font-size: 1.3rem;
box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.muszak-A { background: rgba(96, 165, 250, 0.15); color: var(--color-A); border: 1px solid var(--color-A); }
.muszak-B { background: rgba(74, 222, 128, 0.15); color: var(--color-B); border: 1px solid var(--color-B); }
.muszak-C { background: rgba(251, 191, 36, 0.15); color: var(--color-C); border: 1px solid var(--color-C); }
.muszak-D { background: rgba(248, 113, 113, 0.15); color: var(--color-D); border: 1px solid var(--color-D); }

.today-highlight { border: 2px solid var(--primary); background: linear-gradient(145deg, #1e293b, #1e3a8a); }
.today-label {
position: absolute; top: -8px; left: 20px;
background: var(--primary); color: white;
font-size: 0.65rem; padding: 2px 10px; border-radius: 20px; font-weight: 800;
}

@media (max-width: 480px) {
.filter-panel { grid-template-columns: 1fr; }
.gomb { grid-column: span 1; }
}
</style>
</head>
<body>

<div class="container">
<header>
<h1>FORVIA SMT</h1>
<p>Digitális Műszaknaptár 2026</p>
</header>

<div class="filter-panel">
<div>
<label>Hónap</label>
<select id="honap">
<option value="mind">Összes hónap</option>
<option value="01">Január</option><option value="02">Február</option>
<option value="03">Március</option><option value="04">Április</option>
<option value="05">Május</option><option value="06">Június</option>
<option value="07">Július</option><option value="08">Augusztus</option>
<option value="09">Szeptember</option><option value="10">Október</option>
<option value="11">November</option><option value="12">December</option>
</select>
</div>
<div>
<label>Műszak</label>
<select id="muszak">
<option value="mind">Mind</option>
<option value="A">A</option><option value="B">B</option>
<option value="C">C</option><option value="D">D</option>
</select>
</div>
<button class="gomb" id="maigomb">Ugrás a mai naphoz</button>
</div>

<div id="eredmeny"></div>
</div>

<script>
let muszakok = [];
const vezetok = {'A': 'Czerovszki Zsolt', 'B': 'Hajdu Zoltán', 'C': 'Kamasz Ádám', 'D': 'Komjáti István'};

// JAVÍTOTT DÁTUM KEZELÉS
function parseDatum(str) {
if(!str) return null;
// Pontok kicserélése kötőjelre és szóközök törlése a biztos felismeréshez
const isoStr = str.replace(/\./g, '-').replace(/\s/g, '').replace(/-$/, '');
return new Date(isoStr);
}

function getNapNeve(datumString) {
const d = parseDatum(datumString);
if (!d || isNaN(d.getTime())) return "Ismeretlen";
const napok = ['Vasárnap', 'Hétfő', 'Kedd', 'Szerda', 'Csütörtök', 'Péntek', 'Szombat'];
return napok[d.getDay()];
}

function isHetvege(datumString) {
const d = parseDatum(datumString);
if (!d || isNaN(d.getTime())) return false;
return d.getDay() === 0 || d.getDay() === 6;
}

fetch('muszakok.csv')
.then(r => r.text())
.then(text => {
muszakok = [];
text.split('\n').slice(1).forEach(line => {
if(!line.trim()) return;
let parts = line.split(';;').map(p=>p.trim()).filter(p=>p);
parts.forEach(p=>{
const col = p.split(';').map(e=>e.trim());
if(col.length>=4) muszakok.push({datum: col[0], hely: col[1], muszak: col[3]});
});
});
showData();
});

function showData() {
const honapValaszt = document.getElementById('honap').value;
const muszakValaszt = document.getElementById('muszak').value;
const today = new Date().toISOString().split('T')[0];

let talalatok = muszakok;
if(honapValaszt !== 'mind') talalatok = talalatok.filter(r => r.datum.includes("-" + honapValaszt + "-") || r.datum.includes("." + honapValaszt + "."));
if(muszakValaszt !== 'mind') talalatok = talalatok.filter(r => r.muszak === muszakValaszt);

const napok = {};
talalatok.forEach(r => {
if(!napok[r.datum]) napok[r.datum] = [];
napok[r.datum].push(r);
});

let html = '';
Object.keys(napok).sort().forEach(datum => {
const dObj = parseDatum(datum);
const isToday = dObj && dObj.toISOString().split('T')[0] === today;
const hetvege = isHetvege(datum);

html += `
<div class="day-group" id="${isToday ? 'today-marker' : ''}">
<div class="date-header ${hetvege ? 'weekend' : ''}">
<span>${datum.replace(/-/g, '. ')}${datum.endsWith('.') ? '' : '.'}</span>
<span class="day-name">${getNapNeve(datum)}</span>
</div>`;

napok[datum].forEach(r => {
html += `
<div class="shift-card ${isToday ? 'today-highlight' : ''}">
${isToday ? '<div class="today-label">MAI NAP</div>' : ''}
<div class="shift-info">
<span class="shift-location">${r.hely}</span>
<div class="shift-leader">Vezető: <span class="leader-name">${vezetok[r.muszak] || 'Nincs'}</span></div>
</div>
<div class="shift-badge muszak-${r.muszak}">${r.muszak}</div>
</div>`;
});
html += `</div>`;
});
document.getElementById('eredmeny').innerHTML = html || '<p style="text-align:center; opacity:0.5;">Nincs találat.</p>';
}

document.getElementById('maigomb').addEventListener('click', () => {
const target = document.getElementById('today-marker');
if(target) target.scrollIntoView({behavior: 'smooth', block: 'center'});
else alert("A mai nap nem látható (ellenőrizd a szűrőket).");
});

document.getElementById('honap').addEventListener('change', showData);
document.getElementById('muszak').addEventListener('change', showData);
</script>
</body>
</html>
